\chapter{РЕЗУЛЬТАТЫ ЧИСЛЕННЫХ ЭКСПЕ\-РИ\-МЕН\-ТОВ}\label{chap4}

В качестве примера, иллюстрирующего алгоритм построения обратной связи в реальном времени для централизованного случая, будем рассматривать задачу оптимального управления для объекта, состоящего из трех взаимосвязанных систем и описываемого линейными уравнениями с аддитивными возмущениями $w$:
\begin{align}
\ddot{z_1} &= -2kz_1 + kz_2 + u_1 + w_1,\notag \\
\ddot{z_2} &= -2kz_2 + kz_1 + kz_3 + u_2 + w_2,\label{connected_systems}\\
\ddot{z_3} &= -2kz_3 + kz_2 + u_3 + w_3. \notag
\end{align}

Система (\ref{connected_systems}) описывает систему трех масс ($q=3$, массы для простоты выбраны равными 1), соединенных одинаковыми пружинами жесткости $k$. Управления приложены к каждой из масс.

Управляющее воздействия ограничены по модулю 
$$
    |u_i(t)| \le L,\  t\in [t_0,t_f],\ i \in I = \{1, \ 2, \ 3\},
     $$
и в момент времени $t_f$ требуется перевести объект (\ref{connected_systems}) на терминальное множество, задаваемое ограничениями
\[
	|z_i(t_f)| \le d_1, \ |\dot{z_i}(t_f)| \le d_2, i \in I,
\]
а критерий качества имеет вид:
\[
	\int\limits_{t_0}^{t_f} \sum_{i \in I} |u_i(t)|\,dt \to \min.
\]



Параметры задачи выберем следующим образом:
\[
	k = 10,\ L = 1,\ t_0 = 0,\ t_f = 4.5;
\]
\[
	d_i = 0.1,\ \dot{z_i}(0) = 1,\ z_i(0) = 1,\ i \in I.
\]
Пусть также $N = 100$, тогда период квантования равен $h = \dfrac{1}{N} = \dfrac{1}{100}$.

будем считать, что в конкретном рассматриваемом процессе управления движение объекта описывается дифференциальными уравнениями (\ref{connected_systems}) с аддитивными возмущениями:
\begin{align}
\ddot{z_1}^* &= -2kz_1^* + kz_2^* + u_1^* + w_1^*,\notag \\
\ddot{z_2}^* &= -2kz_2^* + kz_1^* + kz_3^* + u_2^* + w_2^*,\label{object}\\
\ddot{z_3}^* &= -2kz_3^* + kz_2^* + u_3^* + w_3^*, \notag
\end{align}
где возмущение задается следующим образом
\[
w^*(t) =
\begin{pmatrix}
	0.7\,\sin 2t\\
	0.1\,\cos t\\
	-0.05\,\cos 3t\\
\end{pmatrix}, \ \ t\in [t_0, t_f].
\]

Отметим, что, хоть в объекте (\ref{object}) и присутствует возмущение $w^*$, оптимальная обратная связь будет определяться по детерминированной задаче  $P(\tau)$. Такой подход соответствует классическому. Иными словами, для отыскания оптимальной обратной связи будем использовать  математическую модель (\ref{connected_systems}).


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Сведение  к задаче линейного программирования}%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



Сначала сформулируем задачу оптимального управления для системы дифференциальных уравнений первого порядка, как в (\ref{equation_BigSystem}). Произведем замену переменных:
\begin{align}
x_1 &= z_1, \qquad x_3 = z_2, \qquad x_5 = z_3, \notag \\
x_2 &= \dot{z_1}, \qquad x_4 = \dot{z_2}, \qquad x_6 = \dot{z_3}.\notag
\end{align} 
Здесь $n = 6$ --- размерность состояния $x$; $r = q = 3$ --- размерность управления; $m = 2n$ --- число ограничений на состояния $x_i, \ i = 1...n$.

Тогда видно, что задача оптимального управления группой (\ref{connected_systems}) имеет вид (см главу 2):
\begin{equation} \label{form_of_the_task}
\int\limits_{t_0}^{t_f} \sum_{i \in I} |u_i(t)|\,dt \to \min,
\end{equation}
\[
	\dot{x}(t) = Ax(t) + Bu(t),
\]
\[
	x(0) = x_0,  \ Hx(t_f) \le g,
\]
\[
    -L \cdot \mathbbm{1}_{r} \le u(t) \le L \cdot \mathbbm{1}_{r},\  t\in [t_0,t_f],
    \]
где
\[
	A = \begin{pmatrix}
	0 & 1 & 0 & 0 & 0 & 0 \\
	-2k & 0 & k & 0 & 0 & 0 \\
	0 & 0 & 0 & 1 & 0 & 0 \\
	k & 0 & -2k & 0 & k & 0 \\
	0 & 0 & 0 & 0 & 0 & 1 \\
	0 & 0 & k & 0 & -2k & 0 \\
	\end{pmatrix}, \ 	
	B = \begin{pmatrix}
	0 & 0 & 0 \\
	1 & 0 & 0 \\
	0 & 0 & 0 \\
	0 & 1 & 0 \\
	0 & 0 & 0 \\
	0 & 0 & 1 \\
	\end{pmatrix}, \ 	
	x_0 = \begin{pmatrix}
	1\\ 1\\ 1\\ 1\\ 1\\ 1\\
	\end{pmatrix},
\]
\[
H = \begin{pmatrix}
	E_n \\
	-E_n\\
	\end{pmatrix},
\]
\[
	g = 0.1 \cdot \mathbbm{1}_{m},
\]
где $E_n \in \R^{n\times n}$ --- единичная матрица, $\mathbbm{1}_{s}$ --- вектор из единиц размерности $s$.


%Отметим, что, хоть объект (\ref{object}) и присутствует возмущение $w$, оптимальная обратная связь будет определяться по детерминированной задаче  $P(\tau)$. Такой подход соответствует классическому. Иными словами, для отыскания оптимальной обратной связи будем использовать следующую математическую модель:
%\[
%	\dot{x}(t) = Ax(t) + Bu(t).
%\]
%

Используя последовательный подход (см. главу 1), сведем задачу (\ref{form_of_the_task}) к задаче линейного программирования, аналогично тому, как сводили задачу (\ref{main_task}) к задаче (\ref{task_in_LP}). Если после этого применить замену 
$$
    u(s) = z(s) - v(s), \ s \in T_h,
     $$
то в итоге задачу (\ref{form_of_the_task}) можно записать следующим образом:

\begin{equation}\label{task_for_linprog}
	\sum_{s \in T_h}
	c'
	\begin{pmatrix} z(s) \\ v(s) \\ \end{pmatrix} \to \min,
\end{equation}
\[
	\sum_{s \in T_h}
	(D_h(s), -D_h(s))
	\begin{pmatrix} z(s) \\ v(s) \\ \end{pmatrix}  \le \tilde g,
\] 
\[
    0\le z(s) \le L\cdot\mathbbm{1}_r, \ 0\le v(s)\le L\cdot\mathbbm{1}_r,
    \]
где
$c = \mathbbm{1}_{2r}$;
	$D_h(s)$ и $\tilde g$ задаются аналогично тому, как они задавались во второй главе:
	\[
	D_h(s) = \int\limits_{s}^{s+h} H F(t_f,\theta)B(\theta)\,d\theta,\  D_h(s) \in \R^{m \times r};
	\]
	\[
	\tilde g = g - H F(t_f, t_0)x_0 ,\  \tilde g \in  \R^{m}.
	\]



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Построение реализации обратной связи и соответствующей траектории}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Построение программного решения --- первый шаг для построения обратной связи.


Для записи левой части ограничений задачи (\ref{task_for_linprog}) в матричном виде в функции
\begin{lstlisting}
function Ale = Form_LP()

    for_d = @(t)H*F(t_f-t)*b;
    get_d_h = @(s)integral(for_d,s,s+h,'ArrayValued', true);
    d_h_values = zeros(m, r, N_initial);

    for i = 1:N_initial
        d_h_values(:,:,i) = get_d_h(t_0 + i*h-h);
    end

    Ale = [];
    for i = 1:N_initial
        Ale = [Ale  d_h_values(:,:,i) -d_h_values(:,:,i)];
    end
end
\end{lstlisting}
формируется матрица \mcode{Ale} (строки 11-14), которая будет иметь вид:
\begin{equation}\label{Ale}
\begin{pmatrix}
	d_h(t_0) & -d_h(t_0) &  \dots & d_h(t_f) & -d_h(t_f)
	\end{pmatrix}.
\end{equation}


Матрица \mcode{Ale} будет являться одним из параметров стандартной процедуры linprog для решения задач линейного программирования.


В функции
\begin{lstlisting}
function u = P(tau, z)

    N = round((t_f - tau)/h);%new N for new  tau

    g_wave = g - H * F(t_f - tau) * z;

    c = ones(1, 2*r*N);

    ub = L*ones(2*r*N, 1);

    startBlockNumber = N_initial - N + 1; % 1...N_initial

    Opt=optimset('TolFun',1e-9,'TolX',1e-9);

    z_and_v = linprog(c,Ale(:,2*r*startBlockNumber - 5 : 2*r*N_initial),g_wave,[],[],zeros(2*r*N, 1),ub,Opt);

    zv = reshape(z_and_v, 2*r, N);
    u  = zv(1:r,:) - zv(r+1:2*r,:); % r /times N
end
\end{lstlisting}
определяется оптимальная программа для позиции \mcode{(tau, z)}. Входным параметром является позиция \mcode{(tau, z)}.


Результатом стандартной процедуры linprog будет вектор \mcode{z_and_v}, который можно записать в виде:
\[
 \begin{pmatrix}
	z(\tau) \\ v(\tau) \\
	z(\tau + h) \\ v(\tau + h) \\  \vdots \\
	z(t_f) \\ v(t_f)
\end{pmatrix}.
\]
Вектор преобразуется в позиционное решение строками кода под номером 17 и 18.


То есть для получения программного решения позиции \mcode{(tau, z)} достаточно один раз вызвать функцию \mcode{function u = P(tau, z)}. Оно вместе с соотвествующей траекторией строится для сравнения с оптимальной обратной связью в части кода, записанной ниже:

\begin{lstlisting}
U_0 = P(t_0, x_0);

X_0 = trajectory(x_0, t_0, t_f, U_0);

\end{lstlisting}


Функция
\begin{lstlisting}
function x = trajectory(x0, t_begin, t_end, u)
    N = round((t_end - t_begin)/h);
    x = zeros(n, N);
    x(:,1) = x0;
    for j = 1:N
        curr = t_begin + (j-1)*h;
        next = t_begin + j*h;
        x(:, j+1) = F(h) * x(:,j) +  integral(@(t) F(next - t)*b,curr, next, 'ArrayValued', true,'RelTol',0,'AbsTol',1e-12)*u(:, j) + integral(@(t) F(curr - t)* M * w(t), curr, next,'ArrayValued', true,'RelTol',0,'AbsTol',1e-12);
    end
end
\end{lstlisting}
принимает параметры для построения траектории: \mcode{x0} --- начальное состояние, \mcode{t_begin, t_end, u} --- начало, конец управление и само управление. Она возвращает траекторию для указанного отрезка времени.


Оптимальная обратная связь ищется в соответсвии с описанным ранее (в главе 2) алгоритмом следующим образом:
\begin{lstlisting}
X = zeros(n, N_initial);

X(:, 1) = x_0;

U = zeros(r, N_initial);

for k = 1:N_initial
    tau = t_0 + (k - 1)*h;

    u_res = P(tau, X(:, k));

    U(:, k) = u_res(:, 1);

    step_trajectory = trajectory(X(:, k), tau, tau + h, U(:, k));

    X(:, k + 1) = step_trajectory(:,2);
end
\end{lstlisting}

	
Стоит заметить, что в функции \mcode{function u = P(tau, z)} для отыскания позиционного решения для позиции \mcode{(tau, z)} в процедуру linprog вносится часть уже построенной (функцией \mcode{function Ale = Form_LP()} ) матрицы \mcode{Ale}. Для позиции \mcode{(t_0, x_0)} в linprog подается матрица вида (\ref{Ale}), однако для следующей позиции \mcode{(t_0 + h, X(:, 2))} в linprog вносится матрица без первых $2r$ столбцов:


\[
\begin{pmatrix}
	d_h(t_1) & -d_h(t_1) &  \dots & d_h(t_f) & -d_h(t_f)
\end{pmatrix}.
\]


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Результаты. Сравнение с программным решением}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Значение критерия качества для программного решения: $285.0503$.

Значение критерия качества для оптимальной обратной связи: $217.5017$ -- это на $23.6971\% $ лучше программного.

Среднее время выполнения функции \mcode{P(tau, z)} : $0.029$ секунды.

Для визуальной оценки результатов перенесем полученные траектории на фазовые графики. Для $q$ объектов управления получится $q$ фазовых графиков (программное решение -- штриховая линия, реализация оптимальной обратной связи -- сплошная):


\begin{figure}[h!]
    \centering
    \scalebox{.8}{\includegraphics{x}}
    \caption{Фазовые графики}
\end{figure}


\begin{figure}[h!]
    \centering
    \scalebox{.8}{\includegraphics{u}}
    \caption{Соответствующие фазовым графикам управления}
\end{figure}


На фазовых графиках видно, что траектории программных решений (штриховые линии) не попадают на терминальное множество. Это происходит из-за наличия неучтенных возмущений $w$, вносимых в систему на протяжении времени управления. При построении оптимальных обратных связей эти возмущения учитываются посредством уточнения состояния системы для каждого момента $\tau \in T_h$.


Таким образом, решена задача оптимального управления для объекта, состоящего из трех взаимосвязанных систем, она сведена к задаче линейного программирования, построено программное решение и реализация обратной связи и произведен анализ полученных результатов. 